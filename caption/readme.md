# 🤖 VLM을 활용한 지능형 상품 데이터 생성 및 검색 프로젝트

본 문서는 Vision-Language Model(VLM)을 활용하여 상품 데이터 생성 파이프라인을 구축하고, 이를 통해 검색 시스템을 고도화하는 프로젝트의 명세입니다.

---

## 🎯 1. 프로젝트 목표 및 핵심 전략

### 목표
비용 효율성과 검색 실험의 유연성을 동시에 달성하는 지능형 상품 데이터 파이프라인을 구축합니다.

### 핵심 전략: `Extract Once, Utilize Many`
고비용의 VLM 정보 추출은 상품 그룹당 단 한 번만 수행하여, 모델이 생성할 수 있는 모든 정보를 가장 상세하고 원자적인(atomic) 형태의 **'마스터 데이터'**로 저장합니다. 이후, 검색 전략 수립 시 이 마스터 데이터를 레고 블록처럼 자유롭게 조합하여 다양한 검색용 임베딩과 필터링 조건을 저비용으로 생성합니다.

이 접근법은 VLM API 호출 비용을 최소화하고, 데이터 활용성을 극대화하여 민첩하고 효율적인 검색 시스템 운영을 지원합니다.

---

## 🧱 2. 데이터 생성 파이프라인

`Extract Once, Utilize Many` 전략을 구현하기 위한 전체 워크플로우입니다.

### 가. 데이터 추출 이원화 전략
정보의 성격과 비용을 기준으로 추출 작업을 '딥 캡셔닝'과 '단순 속성 추출'로 이원화합니다.

| 구분 | **딥 캡셔닝 (Deep Captioning)** | **단순 속성 추출 (Color Analysis)** | **텍스트 이미지 OCR (Text Image OCR)** |
| :--- | :--- | :--- | :--- |
| **목적** | 스타일, TPO, 감성 등 복잡한 추론이 필요한 **주관적/추상적 정보** 추출 | 색상, 소재 등 객관적으로 식별 가능한 **단순 정보** 추출 | 소재, 사이즈, 관리방법 등 텍스트 기반 상품 정보 추출 |
| **대상** | 상품 그룹을 대표하는 **'대표 이미지' 3장** (정면, 후면, 착용샷 등) | 그룹 내 **모든 개별 상품(SKU) 이미지** (정면 1장) | 상품 상세정보 텍스트 이미지 |
| **비용** | **고비용** (예: GPT-4o, Claude 3 Opus) | **저비용** (예: 저비용 VLM, 색상 추출 API, OpenCV) | OCR 최적화 VLM (예: Gemini 1.5 Flash) |
| **주기** | **상품 그룹당 1회** | **SKU 개수만큼 반복** | **상품 그룹당 1회** |

### 나. 전체 워크플로우
1.  **[기획]** 상품 그룹 정의 및 대표 이미지 선정
    - MD 또는 콘텐츠 관리자가 동일 디자인의 상품들을 하나의 그룹으로 정의합니다.
    - 그룹의 특징을 가장 잘 나타내는 대표 이미지(정면, 후면, 착용샷)를 선정합니다.

2.  **[1회/그룹]** Deep Captioning - 구조적/주관적 정보 추출
    - 대표 이미지를 고성능 VLM에 입력합니다.
    - 색상을 제외한 모든 공통 정보(디자인 디테일, 핏, 스타일/TPO 태그, 다양한 용도별 캡션)를 추출합니다.

3.  **[N회/SKU]** Color Analysis - 색상 전문 분석
    - 그룹 내 모든 개별 SKU 이미지에서 색상 관련 정보만 전문적으로 추출합니다.
    - 색상명, HEX 코드, 명도/채도 속성까지 포함한 상세 색상 분석을 수행합니다.

4.  **[1회/그룹]** Text Image OCR - 상품 정보 추출
    - 상품 상세정보가 포함된 텍스트 이미지에서 소재, 사이즈, 관리방법, 상품설명을 추출합니다.

5.  **[자동화]** 데이터 통합 및 최종 문서 생성
    - 3단계 추출 결과를 조합하여 각 SKU에 대한 완전한 JSON 문서를 생성합니다.
    - 각 SKU는 그룹 공통 정보 + 개별 색상 정보 + 상품 정보를 모두 포함합니다.

6.  **[자동화]** 검색 엔진 색인 (Indexing)
    - 생성된 JSON 문서를 검색 엔진에 최적화된 형태로 색인합니다.
    - 이를 통해 "핑크색 오피스룩 셔츠", "면 소재 캐주얼 상의" 등 복합 쿼리에 대응 가능해집니다.

---

## 🧬 3. '마스터 데이터' 스키마 (상의 예시)

VLM을 통해 추출되는 데이터는 크게 3가지 타입으로 구성됩니다.

1.  **Deep Captioning (`DeepCaptioningTopOutput`)**: 구조화된 속성 + 다양한 캡션
2.  **Color Analysis (`SimpleAttributeOutput`)**: 색상 전문 분석
3.  **Text Image OCR (`TextImageOCROutput`)**: 텍스트에서 추출한 상품 정보

---

## 4. Deep Captioning Output (`DeepCaptioningTopOutput`)

```json
{
  "structured_attributes": {
    "common": {
      "sleeve_length": "긴소매",
      "neckline": "라운드넥"
    },
    "front": {
      "pattern": {
        "type": "스트라이프",
        "description": "세로 방향의 가는 스트라이프"
      },
      "closures_and_embellishments": {
        "type": "버튼/단추",
        "description": "앞면 중앙 버튼 3개"
      }
    },
    "back": {
      "pattern": {
        "type": "스트라이프",
        "description": "정면과 동일한 스트라이프 패턴"
      },
      "closures_and_embellishments": {
        "type": "여밈 없음",
        "description": ""
      }
    },
    "subjective": {
      "fit": "레귤러 핏/스탠다드 핏",
      "style_tags": ["캐주얼", "심플 베이직"],
      "tpo_tags": ["데일리", "데이트/주말"]
    }
  },
  "image_captions": {
    "front_text_specific": "정면에서 본 이 옷은 라운드넥과 버튼 여밈이 특징인 긴소매 상의입니다. 파란색 바탕에 흰색 세로 스트라이프 패턴이 들어가 있습니다.",
    "back_text_specific": "후면은 특별한 여밈이나 장식 없이 깔끔한 디자인이며, 정면과 동일한 스트라이프 패턴이 이어집니다.",
    "design_details_description": "이 상의는 라운드넥, 긴소매 디자인을 가지고 있습니다. 전면에 버튼 여밈이 있으며, 전체적으로 세로 스트라이프 패턴이 적용되었습니다.",
    "style_description": "심플한 스트라이프 패턴과 베이직한 디자인으로 캐주얼하면서도 단정한 느낌을 줍니다.",
    "tpo_context_description": "일상적인 데일리룩이나 편안한 주말 데이트룩으로 활용하기 좋으며, 다양한 하의와 쉽게 매치할 수 있습니다.",
    "comprehensive_description": "파란색과 흰색의 조화가 돋보이는 이 라운드넥 긴소매 상의는 레귤러 핏으로 편안한 착용감을 제공합니다. 앞면의 버튼 디테일과 전체적인 세로 스트라이프 패턴이 특징이며, 캐주얼한 데일리룩이나 주말 나들이 룩에 잘 어울립니다."
  }
}
```

### 4.1. 구조화된 속성 (Structured Attributes)

**공통 속성 (Common)**
- `sleeve_length`: 소매 길이
  - 가능한 값: "민소매", "반소매", "5부/7부", "긴소매"
- `neckline`: 넥라인
  - 가능한 값: "라운드넥", "브이넥", "유넥", "터틀넥/폴라", "카라", "헨리넥", "후드", "스퀘어넥", "보트넥"

**정면/후면 속성 (Front/Back)**
- `pattern`: 패턴 정보
  - `type`: "무지/솔리드", "스트라이프", "체크", "도트", "플로럴", "애니멀 프린트", "페이즐리", "아가일", "기하학", "타이포그래피/레터링", "기타"
  - `description`: 패턴 상세 설명
- `closures_and_embellishments`: 여밈/장식 정보
  - `type`: "여밈 없음", "버튼/단추", "지퍼", "스냅 버튼", "스트링/끈"
  - `description`: 여밈/장식 상세 설명

**주관적 속성 (Subjective)**
- `fit`: 핏 타입 (단일 선택)
  - 가능한 값: "슬림 핏", "레귤러 핏/스탠다드 핏", "오버사이즈 핏"
- `style_tags`: 스타일 태그 (다중 선택)
  - 가능한 값: "모던/미니멀", "심플 베이직", "캐주얼", "스트릿", "포멀", "스포티/애슬레저", "아웃도어", "레트로", "유니크"
- `tpo_tags`: TPO 태그 (다중 선택)
  - 가능한 값: "데일리", "오피스/비즈니스", "격식/하객", "데이트/주말", "여행/휴가", "파티/모임", "운동", "홈웨어/라운지"

### 4.2. 이미지 캡션 (Image Captions)

- `front_text_specific`: 정면 이미지 전용 설명 (색상 포함)
- `back_text_specific`: 후면 이미지 전용 설명 (색상 포함)
- `design_details_description`: 디자인 디테일 종합 설명 (색상 제외)
- `style_description`: 스타일 특성 설명 (색상 제외)
- `tpo_context_description`: TPO 상황 설명 (색상 제외)
- `comprehensive_description`: 모든 정보를 포함한 종합 설명

---

## 5. Color Analysis Output (`SimpleAttributeOutput`)
각 색상 변형(SKU)에 대한 전문적인 색상 분석 결과입니다.

```json
{
  "color_info": [
    {
      "name": "블루",
      "hex": "#4A90E2",
      "attributes": {
        "brightness": "밝음",
        "saturation": "높음"
      }
    },
    {
      "name": "화이트",
      "hex": "#FFFFFF",
      "attributes": {
        "brightness": "아주 밝음",
        "saturation": "아주 낮음"
      }
    }
  ]
}
```

### 색상 정보 구조 (`color_info` 배열의 요소)
- `name`: 대표 색상명
  - 가능한 값: "화이트", "그레이", "블랙", "레드", "핑크", "옐로우", "오렌지", "그린", "블루", "퍼플", "브라운", "베이지", "데님", "메탈릭", "멀티컬러", "기타"
- `hex`: HEX 색상 코드 (예: `#4A90E2`)
- `attributes`: 색상 속성
  - `brightness`: 명도 ("아주 밝음", "밝음", "중간 밝기", "어두움", "아주 어두움")
  - `saturation`: 채도 ("아주 낮음", "낮음", "중간 채도", "높음", "아주 높음")

---

## 📝 6. Text Image OCR Output (`TextImageOCROutput`)
텍스트 이미지에서 추출한 상품 상세 정보입니다.

```json
{
  "material_info": "면 100%",
  "size_info": {
    "is_exist": true,
    "size_measurements": {
      "S": {
        "총장": "68",
        "가슴단면": "50",
        "어깨너비": "45"
      },
      "M": {
        "총장": "70",
        "가슴단면": "52",
        "어깨너비": "47"
      },
      "L": {
        "총장": "72",
        "가슴단면": "54",
        "어깨너비": "49"
      }
    }
  },
  "care_info": "찬물 단독세탁, 건조기 사용 금지",
  "product_description": "부드러운 면 소재로 제작된 편안한 착용감의 베이직 셔츠입니다. 세련된 스트라이프 패턴으로 캐주얼부터 세미정장까지 다양하게 연출 가능합니다."
}
```

### 텍스트 추출 정보
- `material_info`: 소재 구성 정보 (nullable)
  - 예: "면 100%", "울 80%, 나일론 20%", "폴리에스터 65%, 레이온 30%, 스판덱스 5%"
- `size_info`: 사이즈 정보
  - `is_exist`: 사이즈 정보 존재 여부 (boolean)
  - `size_measurements`: 사이즈별 실측 정보 (Dictionary 또는 JSON 문자열)
- `care_info`: 세탁 및 관리 방법 (nullable)
- `product_description`: 상품 소개 및 특징 요약 (nullable)

---

## 🚀 7. 검색 최적화를 위한 임베딩 전략
'마스터 데이터' 내의 다양한 캡션을 활용하여, 여러 검색 시나리오에 대응하는 목적별 임베딩을 생성합니다.

**색상 제외 임베딩 (구조/스타일 검색)**
- `design_details_description`
  - 내용: 셔츠 칼라, 포켓 등 순수 디자인 구조와 객관적 디테일
  - 목적: '주머니 달린 셔츠'와 같은 형태 기반 검색 정확도 강화
- `style_description`
  - 내용: 캐주얼, 미니멀, 단정한 무드 등 추상적인 스타일과 분위기
  - 목적: '미니멀한 스타일 상의'와 같은 감성/스타일 기반 검색 정확도 강화
- `tpo_context_description`
  - 내용: 데일리룩, 오피스룩 등 활용 목적과 상황
  - 목적: '출근할 때 입을 셔츠'와 같은 상황(TPO) 기반 검색 정확도 강화

**색상 포함 임베딩 (멀티모달 검색)**
- `front_text_specific` / `back_text_specific`
  - 내용: "블루 스트라이프 셔츠"와 같이 실제 SKU 이미지와 완벽히 일치하는 정보
  - 목적: 이미지-텍스트 멀티모달 검색 및 이미지 유사도 검색 정확도 극대화
- `comprehensive_description`
  - 내용: "산뜻한 블루 색상의 미니멀한 스트라이프 셔츠로, 오피스룩에 잘 어울립니다."
  - 목적: 모든 정보를 포괄하는 범용 임베딩으로 활용