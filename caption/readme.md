# VLM을 활용한 지능형 상품 데이터 생성 및 검색 프로젝트

본 문서는 Vision-Language Model(VLM)을 활용하여 상품 데이터 생성 파이프라인을 구축하고, 이를 통해 검색 시스템을 고도화하는 프로젝트의 명세입니다.

## 🎯 1. 프로젝트 목표 및 핵심 전략

### 목표

비용 효율성과 검색 실험의 유연성을 동시에 달성하는 지능형 상품 데이터 파이프라인을 구축합니다.

### 핵심 전략: `Extract Once, Utilize Many`

고비용의 VLM 정보 추출은 **상품 그룹당 단 한 번**만 수행하여, 모델이 생성할 수 있는 모든 정보를 가장 상세하고 원자적인(atomic) 형태의 **'마스터 데이터'**로 저장합니다. 이후, 검색 전략 수립 시 이 마스터 데이터를 레고 블록처럼 자유롭게 조합하여 다양한 검색용 임베딩과 필터링 조건을 저비용으로 생성합니다.

이 접근법은 VLM API 호출 비용을 최소화하고, 데이터 활용성을 극대화하여 민첩하고 효율적인 검색 시스템 운영을 지원합니다.

---

## 🧱 2. 데이터 생성 파이프라인

`Extract Once, Utilize Many` 전략을 구현하기 위한 전체 워크플로우입니다.

### 가. 데이터 추출 이원화 전략

정보의 성격과 비용을 기준으로 추출 작업을 '딥 캡셔닝'과 '단순 속성 추출'로 이원화합니다.

| 구분 | **딥 캡셔닝 (Deep Captioning)** | **단순 속성 추출 (Simple Attribute Extraction)** |
| --- | --- | --- |
| **목적** | 스타일, TPO, 감성 등 복잡한 추론이 필요한 **주관적/추상적 정보** 추출 | 색상, 소재 등 객관적으로 식별 가능한 **단순 정보** 추출 |
| **대상** | 상품 그룹을 대표하는 **'대표 이미지' 3장** (정면, 후면, 착용샷 등) | 그룹 내 **모든 개별 상품(SKU) 이미지** (정면 1장) |
| **비용** | **고비용** (예: GPT-4o, Claude 3 Opus) | **저비용** (예: 저비용 VLM, 색상 추출 API, OpenCV) |
| **주기** | **상품 그룹당 1회** | **SKU 개수만큼 반복** |

### 나. 전체 워크플로우

1. **[기획] 상품 그룹 정의 및 대표 이미지 선정**
    - MD 또는 콘텐츠 관리자가 동일 디자인의 상품들을 하나의 그룹으로 정의하고, 그룹의 특징을 가장 잘 나타내는 이미지를 '대표 이미지'로 선정합니다.
2. **[1회/그룹] 딥 캡셔닝 (공통 정보 추출)**
    - `대표 이미지`를 고성능 VLM에 입력하여, 색상을 제외한 모든 공통 정보(카테고리, 디자인 디테일, 핏, 스타일/무드/TPO 태그, 서술형 캡션 등)를 추출합니다.
3. **[N회/SKU] 단순 속성 추출 (개별 정보 추출)**
    - 그룹 내 모든 개별 SKU 이미지(예: 블루 셔츠, 핑크 셔츠)에서 `색상 관련 정보`만 저비용으로 추출합니다.
4. **[자동화] 데이터 통합 및 최종 문서 생성**
    - 백엔드 스크립트가 2단계의 '공통 정보'와 3단계의 개별 '색상 정보'를 조합하여, 각 SKU에 대한 완전한 `JSON 문서`를 생성합니다.
5. **[자동화] 검색 엔진 색인 (Indexing)**
    - 생성된 JSON 문서를 검색 엔진(예: Elasticsearch)에 최적화된 형태로 가공하여 색인합니다. 각 SKU 문서는 부모 그룹의 공통 정보를 모두 포함하므로, '핑크색 오피스룩 셔츠'와 같은 복합 쿼리에 효과적으로 응답할 수 있습니다.

---

## 🧬 3. '마스터 데이터' 스키마 (상의 예시)

VLM 추출 결과는 미래의 모든 검색 전략을 뒷받침할 수 있도록 구조화된 JSON 형태로 설계합니다. 스키마는 상품 그룹 전체에 적용되는 **공통 정보(`base_product_info`)**와 개별 색상별 **특화 정보(`variants`)**로 명확히 분리됩니다.

'''json
{
  "product_group_id": "P0001",
  "vlm_extraction_date": "2025-06-25",

  // --- 딥 캡셔닝 결과: 모든 색상에 공통 적용 ---
  "base_product_info": {
    "structured_attributes": {
      "common": { 
	      "category_l1": "상의",
	      "category_l2": "셔츠",
	      "sleeve_length": "긴소매",
	      "neckline" : "U넥"
	    },
      "front": {
        "pattern": { "type": "스트라이프", "description": "세로 방향의 가는 스트라이프 프린팅" },
        "closures_and_embellishments": [{ "type": "버튼", "position": "중앙 여밈" }, { "type": "포켓", "position": "왼쪽 가슴" }]
      },
      "back": {
        "closures_and_embellishments": [{ "type": "플리츠", "position": "등 중앙", "description": "활동성을 위한 센터 플리츠" }]
      },
      "subjective": {
        "fit": "레귤러핏",
        "style_tags": ["캐주얼", "미니멀", "프렌치시크"],
        "mood_tags": ["단정한", "산뜻한", "차분한"],
        "tpo_tags": ["데일리룩", "오피스룩", "데이트룩", "봄나들이"]
      }
    },
    "embedding_captions": {
      "design_details_description": "클래식한 셔츠 칼라와 세로 스트라이프 패턴이 특징입니다. 정면은 버튼으로 여밀 수 있고 왼쪽 가슴에는 포켓이 있습니다.",
      "style_vibe_description": "캐주얼하면서도 미니멀한 프렌치시크 스타일을 연출하며, 단정하고 산뜻한 분위기를 풍깁니다.",
      "tpo_context_description": "일상적인 데일리룩은 물론, 깔끔한 오피스룩이나 데이트룩으로도 손색이 없습니다."
    }
  },

  // --- 단순 속성 추출 결과: 개별 색상별 정보 ---
  "variants": [
    {
      "sku_id": "P0001-BLUE",
      "is_representative": true,
      "product_image_url": "<https://example.com/images/p0001_blue.jpg>",
      "color": {
        "primary": { "name": "블루", "hex": "#4A90E2", "attributes": ["차가운", "선명한"] },
        "secondary": [{ "name": "화이트", "hex": "#FFFFFF", "attributes": ["밝은", "깨끗한"] }],
        "all_colors": ["블루", "화이트"],
        "all_color_attributes": ["차가운", "선명한", "밝은", "깨끗한"]
      },
      "embedding_captions": {
        "front_text_specific": "흰색 버튼이 달린 블루 스트라이프 코튼 셔츠의 정면 이미지.",
        "back_text_specific" : ""
      }
    },
    {
      "sku_id": "P0001-PINK",
      "is_representative": false,
      "product_image_url": "<https://example.com/images/p0001_pink.jpg>",
      "color": {
        "primary": { "name": "핑크", "hex": "#FFC0CB", "attributes": ["따뜻한", "파스텔"] },
        "secondary": [{ "name": "화이트", "hex": "#FFFFFF", "attributes": ["밝은", "깨끗한"] }],
        "all_colors": ["핑크", "화이트"],
        "all_color_attributes": ["따뜻한", "파스텔", "밝은", "깨끗한"]
      },
      "embedding_captions": {
        "clip_text_specific": "흰색 버튼이 달린 핑크 스트라이프 코튼 셔츠의 정면 이미지."
      }
    }
  ]
}
```

---

## 🏷️ 4. VLM 속성 분류 체계 (Attribute Taxonomy)

VLM이 `structured_attributes` 필드를 일관성 있게 생성하기 위해 따라야 할 분류 체계입니다.

- **1. 색상 (Color)**
    - **Level 1: 대표 색상 (Primary Color Name)** - `단일 선택`
        - `화이트`, `그레이`, `블랙`, `레드`, `핑크`, `옐로우`, `오렌지`, `그린`, `블루`, `퍼플/바이올렛`, `브라운`, `베이지/크림`, `데님`, `메탈릭`, `멀티컬러`, `기타`
    - **Level 2: 색상 속성 태그 (Color Attribute Tags)** - `다중 선택`
        - **명도**: `밝은`, `어두운`, `딥`
        - **채도**: `선명한`, `흐릿한`, `페일`, `그레이시`
        - **톤&느낌**: `파스텔`, `네온`, `웜톤`, `쿨톤`, `뉴트럴`, `소프트`
- **2. 넥라인 (Neckline)** - `단일 선택`
    - `라운드넥`, `브이넥`, `유넥`, `터틀넥/폴라`, `카라`, `헨리넥`, `후드`, `스퀘어넥`, `보트넥`
- **3. 소매 길이 (Sleeve Length)** - `단일 선택`
    - `민소매`, `반소매`, `5부/7부`, `긴소매`
- **4. 패턴 (Pattern)** - `단일 선택 (Type) + 서술 (Description)`
    - **Type**: `스트라이프`, `체크`, `도트`, `플로럴`, `애니멀 프린트`, `페이즐리`, `아가일`, `기하학`, `타이포그래피/레터링`, `기타`
- **5. 여밈 방식 (Closures)** - `다중 선택`
    - `여밈 없음`, `버튼(단추)`, `지퍼`, `스냅 버튼`, `스트링/끈`
- **6. 핏 (Fit)** - `단일 선택`
    - `슬림 핏`, `레귤러 핏/스탠다드 핏`, `오버사이즈 핏`
- **7. 스타일 태그 (Style Tags)** - `다중 선택`
    - `모던/미니멀`, `심플 베이직`, `캐주얼`, `스트릿`, `포멀/클래식`, `스포티/애슬레저`, `아웃도어`, `빈티지/레트로`, `유니크`
- **8. TPO 태그 (TPO Tags)** - `다중 선택`
    - `데일리`, `오피스/비즈니스`, `격식/하객`, `데이트/주말`, `여행/휴가`, `파티/모임`, `운동`, `홈웨어/라운지`

---

## 🚀 5. 검색 최적화를 위한 임베딩 전략

'마스터 데이터' 내의 다양한 캡션을 활용하여, 여러 검색 시나리오에 대응하는 목적별 임베딩을 생성합니다.

- **`design_details_description` (색상 미포함)**
    - **내용**: 셔츠 칼라, 포켓 등 순수 디자인 구조와 객관적 디테일
    - **목적**: '주머니 달린 셔츠'와 같은 **형태 기반 검색** 정확도 강화
- **`style_vibe_description` (색상 미포함)**
    - **내용**: 캐주얼, 미니멀, 단정한 무드 등 추상적인 스타일과 분위기
    - **목적**: '미니멀한 스타일 상의'와 같은 **감성/스타일 기반 검색** 정확도 강화
- **`tpo_context_description` (색상 미포함)**
    - **내용**: 데일리룩, 오피스룩 등 활용 목적과 상황
    - **목적**: '출근할 때 입을 셔츠'와 같은 **상황(TPO) 기반 검색** 정확도 강화
- **`front_text_specific` / `back_text_specific` (색상 포함)**
    - **내용**: "블루 스트라이프 셔츠"와 같이 실제 SKU 이미지와 완벽히 일치하는 정보
    - **목적**: **이미지-텍스트 멀티모달 검색** 및 **이미지 유사도 검색** 정확도 극대화
- **(추가 제안) `comprehensive_description` (색상 포함)**
    - **내용**: "산뜻한 블루 색상의 미니멀한 스트라이프 셔츠로, 오피스룩에 잘 어울립니다."와 같이 공통 정보와 개별 색상 정보를 결합한 종합 설명문
    - **목적**: 단일 임베딩 필드만 사용해야 할 경우, 모든 정보를 포괄하는 **범용 임베딩**으로 활용